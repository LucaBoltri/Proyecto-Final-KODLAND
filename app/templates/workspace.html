<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>L√∫mina ‚Äî Workspace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="theme">

<div class="wrapper">

  <!-- Header -->
  <div class="header topbar">
    <a class="btn ghost back" href="{{ url_for('upload') }}">
      <img src="{{ url_for('static', filename='media/icons/icon-button-home.svg') }}" alt="Home" style="width:1.3em; height:1.3em; margin-right:8px; vertical-align:middle;" />
      <span style="font-size:1.18em; font-weight:700; vertical-align:-0.08em; position:relative; top:-1px; color:#fff;">HOME</span>
    </a>

  <!-- ====== HERO (igual que en Upload) ====== -->
  <section class="upload-hero">
    <div class="title-row">
      <span class="title-line"></span>
      <h1 class="upload-title">L√∫mina</h1>
      <span class="title-line"></span>
    </div>
    <div class="upload-subtitle">Escuch√° y entend√© tus videos como nunca antes.</div>
  </section>

  <!-- Esfera con glow (mismo efecto) -->
  <div class="upload-spark">
    <img
      class="spark-icon"
      src="{{ url_for('static', filename='media/icons/icon-esfera-fuego.png') }}"
      alt=""
      loading="lazy"
    />
  </div>

  <!-- === LAYOUT 2 COLUMNAS === -->
  <div class="workspace two-col">

    <!-- Izquierda: Video + meta -->
    <section class="ws-left card">
      <div class="video-wrap">
        {% if video_url %}
          <video controls preload="metadata" playsinline>
            <source src="{{ video_url }}" type="video/mp4" />
            {# Inyectamos las pistas para que salgan en el men√∫ del player #}
            {% if tracks %}
              {% set labels = {'es':'Espa√±ol','en':'English','pt':'Portugu√™s','it':'Italiano','fr':'Fran√ßais'} %}
              {% for code, url in tracks.items() %}
                <track kind="subtitles"
                       srclang="{{ code }}"
                       label="{{ labels.get(code, code|upper) }}"
                       src="{{ url }}"
                       {% if loop.first %}default{% endif %}>
              {% endfor %}
            {% endif %}
          </video>
        {% else %}
          <div class="muted">Video no disponible todav√≠a.</div>
        {% endif %}
      </div>

      {% if filename or detected_lang or size_human %}
      <div class="meta" style="margin-top:12px">
        {% if filename %}<span>üé¨ {{ filename }}</span>{% endif %}
        {% if size_human %}<span>üì¶ {{ size_human }}</span>{% endif %}
        {% if detected_lang %}<span>üåê Idioma detectado: {{ detected_lang }}</span>{% endif %}
      </div>
      {% endif %}
    </section>

    <!-- Derecha: Panel con pesta√±as -->
    <aside class="ws-right card">

      <!-- Radios invisibles que controlan las pesta√±as -->
      <div class="tabs">
        <input type="radio" id="tab-summary" name="pane" checked>
        <input type="radio" id="tab-subs" name="pane">
        <div class="tab-btn-row">
          <label class="tab-btn tab-btn-summary" for="tab-summary">
            <img class="tab-icon resumen-icon resumen-on" src="{{ url_for('static', filename='media/icons/icon-button-resumir-on.svg') }}" alt="Resumir seleccionado" />
            <img class="tab-icon resumen-icon resumen-off" src="{{ url_for('static', filename='media/icons/icon-button-resumir-off.svg') }}" alt="Resumir" />
            <span>Resumir</span>
          </label>
          <label class="tab-btn tab-btn-subs" for="tab-subs">
            <img class="tab-icon subtitular-icon subtitular-on" src="{{ url_for('static', filename='media/icons/icon-button-subtitular-on.svg') }}" alt="Subtitular seleccionado" />
            <img class="tab-icon subtitular-icon subtitular-off" src="{{ url_for('static', filename='media/icons/icon-button-subtitular-off.svg') }}" alt="Subtitular" />
            <span>Subtitular</span>
          </label>
        </div>
        <!-- Contenido de las pesta√±as -->
        <div class="panes">

          <!-- PESTA√ëA: RESUMEN -->
          <div class="pane pane-summary">
            <div class="segment">
              <h3>Idioma del Resumen</h3>
              <form action="{{ url_for('summary', file_id=file_id) }}" method="POST" class="row gap">
                {% if summary_pending %}
                <div style="width:100%;margin-bottom:8px;">
                  <div style="background:#f2e9d6;border-radius:999px;height:10px;width:100%;overflow:hidden;">
                    <div style="height:100%;width:100%;background:#ff5e8a;border-radius:999px;animation:chargebar 3s linear forwards;"></div>
                  </div>
                </div>
                {% endif %}
                <div style="display:flex; gap:16px; align-items:stretch; width:100%;">
                  <select id="sum_lang" name="sum_lang" class="select-strong" style="flex:1; min-width:120px; height:48px;">
                    {% set sl = summary_lang or 'es' %}
                    <option value="es" {{ 'selected' if sl=='es' else '' }}>Espa√±ol</option>
                    <option value="en" {{ 'selected' if sl=='en' else '' }}>English</option>
                    <option value="pt" {{ 'selected' if sl=='pt' else '' }}>Portugu√™s</option>
                    <option value="it" {{ 'selected' if sl=='it' else '' }}>Italiano</option>
                    <option value="fr" {{ 'selected' if sl=='fr' else '' }}>Fran√ßais</option>
                  </select>
                  <button class="btn primary" type="submit" id="btn-gen-summary" style="flex:1; min-width:160px; height:48px; font-weight:700; margin-top:0; align-self:center;">
                    GENERAR RESUMEN
                    <img src="{{ url_for('static', filename='media/icons/icon-button-generar-resumen.svg') }}" alt="Generar" style="width:1.15em; height:1.15em; margin-left:10px; vertical-align:-0.2em; filter:brightness(0.8);" />
                  </button>
                </div>
              </form>
            </div>

            {% if summary %}
            <div class="segment">
              <div class="summary-box mono">{{ summary }}</div>

              <div class="row gap actions-bar" style="margin-top:10px">
                <button class="btn ghost" type="button" id="btn-copy-summary">COPIAR</button>

                {% if summary_audio_url %}
                  <audio id="summaryAudio" controls preload="metadata" style="flex:1; min-width:260px">
                    <source src="{{ summary_audio_url }}" type="audio/mpeg">
                  </audio>
                {% endif %}

                {% if txt_url %}
                  <a class="btn ghost" href="{{ txt_url }}" download>DESCARGAR</a>
                {% endif %}
              </div>
            </div>
            {% endif %}
          </div>

          <!-- PESTA√ëA: SUBT√çTULOS -->
          <div class="pane pane-subs">
            <div class="segment">
              <h3>Idioma de Subt√≠tulos</h3>

              <form action="{{ url_for('generate_tracks', file_id=file_id) }}" method="POST" class="col gap">
                <select name="lang" class="select-strong">
                  {% set existing = existing_tracks or [] %}
                  {% for code,label in [('es','Espa√±ol'),('en','English'),('pt','Portugu√™s'),('it','Italiano'),('fr','Fran√ßais')] %}
                    <option value="{{ code }}" {{ 'disabled' if code in existing else '' }}>
                      {{ label }}{% if code in existing %} ‚Äî ya generado{% endif %}
                    </option>
                  {% endfor %}
                </select>

                <div class="row gap">
                  <button class="btn primary" type="submit">GENERAR PISTA ‚ñ∏</button>
                  {% if srt_url %}
                    <a class="btn ghost" href="{{ srt_url }}" download>DESCARGAR .SRT</a>
                  {% endif %}
                </div>
              </form>

              {% if tracks %}
              <div class="muted footnote" style="margin-top:12px">
                <strong>Pistas disponibles:</strong>
                {% for code, url in tracks.items() %}
                  <div>‚Ä¢ {{ code|upper }} ‚Üí <a class="download" href="{{ url }}" download>descargar VTT</a></div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>

        </div> <!-- .panes -->
      </div> <!-- .tabs -->

    </aside>
  </div> <!-- .workspace.two-col -->

</div> <!-- wrapper -->

<script>
  // Copiar resumen al portapapeles
  (function () {
    const btn = document.getElementById('btn-copy-summary');
    if (!btn) return;
    btn.addEventListener('click', () => {
      const box = document.querySelector('.summary-box');
      if (!box) return;
      const txt = box.innerText || box.textContent || '';
      navigator.clipboard.writeText(txt).then(() => {
        btn.textContent = '¬°Copiado!';
        setTimeout(() => (btn.textContent = 'COPIAR'), 1500);
      }).catch(() => {
        btn.textContent = 'Error';
        setTimeout(() => (btn.textContent = 'COPIAR'), 1500);
      });
    });
  })();
</script>

</body>
</html>
